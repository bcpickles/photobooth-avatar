<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create a profile picture with your Minecraft character and fun backgrounds!">
    <title>Minecraft Photo Booth | Minecraft 4 All</title>
    
    <!-- Three.js for 3D character rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- JSZip for handling MCPACK files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
/* ============================================
   MINECRAFT PHOTO BOOTH STYLES
   Accessible, playful design for K-5 students
   ============================================ */

/* ===== CSS VARIABLES ===== */
:root {
    /* Minecraft-inspired color palette */
    --minecraft-grass: #7CB342;
    --minecraft-dirt: #8D6E63;
    --minecraft-stone: #78909C;
    --minecraft-sky: #4FC3F7;
    --minecraft-gold: #FFB300;
    --minecraft-redstone: #E53935;
    --minecraft-diamond: #42A5F5;
    --minecraft-emerald: #00C853;
    
    /* UI Colors */
    --primary-color: #4CAF50;
    --primary-hover: #45a049;
    --secondary-color: #2196F3;
    --accent-color: #FF9800;
    --success-color: #66BB6A;
    --disabled-color: #BDBDBD;
    
    /* Neutral Colors */
    --bg-light: #F5F5F5;
    --bg-white: #FFFFFF;
    --text-dark: #212121;
    --text-medium: #616161;
    --text-light: #9E9E9E;
    --border-color: #E0E0E0;
    
    /* Shadows */
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
    --shadow-lg: 0 8px 16px rgba(0,0,0,0.2);
    
    /* Spacing */
    --spacing-xs: 0.5rem;
    --spacing-sm: 1rem;
    --spacing-md: 1.5rem;
    --spacing-lg: 2rem;
    --spacing-xl: 3rem;
    
    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    
    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-medium: 0.3s ease;
}

/* ===== RESET & BASE STYLES ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--minecraft-sky) 0%, var(--minecraft-grass) 100%);
    color: var(--text-dark);
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* ===== ACCESSIBILITY ===== */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Focus styles for keyboard navigation */
*:focus-visible {
    outline: 3px solid var(--accent-color);
    outline-offset: 2px;
}

/* Skip to main content link */
.skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--primary-color);
    color: white;
    padding: var(--spacing-sm);
    text-decoration: none;
    z-index: 100;
}

.skip-link:focus {
    top: 0;
}

/* ===== HEADER ===== */
.app-header {
    background: var(--bg-white);
    box-shadow: var(--shadow-md);
    padding: var(--spacing-md) var(--spacing-lg);
    position: sticky;
    top: 0;
    z-index: 10;
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
}

.app-header h1 {
    font-size: clamp(1.5rem, 4vw, 2rem);
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.emoji {
    display: inline-block;
    font-style: normal;
}

.emoji.large {
    font-size: 3rem;
}

/* Header Controls */
.header-controls {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

/* Language Toggle */
.language-toggle {
    display: flex;
    background: var(--bg-light);
    border-radius: var(--radius-lg);
    padding: 4px;
    gap: 4px;
}

.lang-btn {
    padding: var(--spacing-xs) var(--spacing-md);
    border: none;
    background: transparent;
    color: var(--text-medium);
    font-weight: 600;
    font-size: 1rem;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
    min-width: 44px;
    min-height: 44px;
}

.lang-btn:hover {
    background: var(--bg-white);
}

.lang-btn.active {
    background: var(--primary-color);
    color: white;
}

/* Help Button */
.help-btn {
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--secondary-color);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-size: 1rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.help-btn:hover {
    background: #1976D2;
    transform: scale(1.05);
}

/* ===== MAIN CONTAINER ===== */
.photo-booth-container {
    flex: 1;
    max-width: 1400px;
    width: 100%;
    margin: var(--spacing-lg) auto;
    padding: 0 var(--spacing-md);
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--spacing-lg);
    align-items: start;
}

/* ===== PREVIEW SECTION ===== */
.preview-section {
    position: sticky;
    top: calc(80px + var(--spacing-lg));
}

.preview-frame {
    background: var(--bg-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--spacing-lg);
    position: relative;
    overflow: hidden;
}

.photo-canvas {
    width: 100%;
    height: auto;
    aspect-ratio: 1;
    display: block;
    border-radius: var(--radius-md);
    background: linear-gradient(135deg, var(--minecraft-sky) 0%, var(--minecraft-grass) 100%);
}

.character-preview {
    width: 100%;
    aspect-ratio: 1;
    border-radius: var(--radius-md);
    position: relative;
}

.preview-placeholder {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: var(--text-medium);
    z-index: 1;
}

.preview-placeholder p {
    font-size: 1.25rem;
    margin-top: var(--spacing-sm);
}

/* ===== CONTROL PANEL ===== */
.control-panel {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

/* Step Containers */
.step {
    background: var(--bg-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
    padding: var(--spacing-lg);
    transition: all var(--transition-medium);
    opacity: 0.5;
    pointer-events: none;
}

.step.active {
    opacity: 1;
    pointer-events: auto;
}

.step:not(.active) {
    filter: grayscale(50%);
}

/* Step Header */
.step-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    padding-bottom: var(--spacing-sm);
    border-bottom: 3px solid var(--border-color);
}

.step-number {
    width: 40px;
    height: 40px;
    background: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
}

.step-header h2 {
    font-size: 1.5rem;
    color: var(--text-dark);
}

.step-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

/* ===== STEP 1: UPLOAD ZONE ===== */
.upload-zone {
    border: 3px dashed var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-medium);
    background: var(--bg-light);
    position: relative;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.upload-zone:hover,
.upload-zone:focus {
    border-color: var(--primary-color);
    background: #E8F5E9;
    transform: scale(1.02);
}

.upload-zone.dragging {
    border-color: var(--primary-color);
    background: #C8E6C9;
    transform: scale(1.05);
}

.file-input {
    position: absolute;
    width: 1px;
    height: 1px;
    opacity: 0;
    pointer-events: none;
}

.upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
}

.upload-text {
    font-size: 1.25rem;
    color: var(--text-dark);
}

.upload-text strong {
    color: var(--primary-color);
}

.secondary-text {
    font-size: 1rem;
    color: var(--text-medium);
}

.upload-hint {
    font-size: 0.875rem;
    color: var(--text-light);
    margin-top: var(--spacing-xs);
}

/* Upload Status */
.upload-status {
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    font-weight: 500;
    text-align: center;
    display: none;
}

.upload-status.success {
    background: #C8E6C9;
    color: #2E7D32;
    display: block;
}

.upload-status.error {
    background: #FFCDD2;
    color: #C62828;
    display: block;
}

/* ===== STEP 2: BACKGROUND GALLERY ===== */
.background-gallery {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-sm);
}

.background-option {
    aspect-ratio: 1;
    border: 3px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-light);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--text-dark);
    font-weight: 600;
    min-width: 44px;
    min-height: 44px;
}

.background-option .emoji {
    font-size: 2.5rem;
}

.background-option:hover {
    border-color: var(--secondary-color);
    background: #E3F2FD;
    transform: scale(1.05);
}

.background-option:active,
.background-option[aria-checked="true"] {
    border-color: var(--secondary-color);
    background: var(--secondary-color);
    color: white;
    box-shadow: var(--shadow-md);
}

.bg-label {
    text-align: center;
}

.background-status {
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    font-weight: 500;
    text-align: center;
    display: none;
}

.background-status.success {
    background: #E3F2FD;
    color: #1565C0;
    display: block;
}

/* ===== STEP 3: ADJUST CONTROLS ===== */
.control-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.control-group label {
    font-weight: 600;
    color: var(--text-dark);
    font-size: 1rem;
}

/* Zoom Slider */
.zoom-slider {
    width: 100%;
    height: 8px;
    border-radius: var(--radius-sm);
    background: var(--bg-light);
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
}

.zoom-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    transition: all var(--transition-fast);
    box-shadow: var(--shadow-sm);
}

.zoom-slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    transition: all var(--transition-fast);
    box-shadow: var(--shadow-sm);
    border: none;
}

.zoom-slider::-webkit-slider-thumb:hover {
    background: var(--primary-hover);
    transform: scale(1.2);
}

.zoom-slider::-moz-range-thumb:hover {
    background: var(--primary-hover);
    transform: scale(1.2);
}

.slider-value {
    text-align: right;
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1rem;
}

/* Pose Selector */
.pose-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-sm);
}

.pose-btn {
    aspect-ratio: 1;
    border: 3px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-light);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm);
    font-size: 0.75rem;
    color: var(--text-dark);
    font-weight: 600;
    min-width: 44px;
    min-height: 44px;
}

.pose-btn .emoji {
    font-size: 2rem;
}

.pose-btn:hover {
    border-color: var(--accent-color);
    background: #FFF3E0;
    transform: scale(1.05);
}

.pose-btn.active,
.pose-btn[aria-checked="true"] {
    border-color: var(--accent-color);
    background: var(--accent-color);
    color: white;
    box-shadow: var(--shadow-md);
}

.pose-label {
    text-align: center;
}

/* ===== ACTION FOOTER ===== */
.action-footer {
    background: var(--bg-white);
    box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
    padding: var(--spacing-lg);
    position: sticky;
    bottom: 0;
}

.button-container {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

/* Primary Buttons */
.primary-btn {
    padding: var(--spacing-md) var(--spacing-xl);
    font-size: 1.5rem;
    font-weight: 700;
    border: none;
    border-radius: var(--radius-xl);
    cursor: pointer;
    transition: all var(--transition-medium);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    min-width: 200px;
    justify-content: center;
    box-shadow: var(--shadow-md);
    min-height: 60px;
}

.take-photo-btn {
    background: var(--primary-color);
    color: white;
}

.take-photo-btn:hover:not(:disabled) {
    background: var(--primary-hover);
    transform: scale(1.05) translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.take-photo-btn:active:not(:disabled) {
    transform: scale(0.98);
}

.take-photo-btn:disabled {
    background: var(--disabled-color);
    color: white;
    cursor: not-allowed;
    opacity: 0.6;
}

.download-btn {
    background: var(--accent-color);
    color: white;
}

.download-btn:hover {
    background: #F57C00;
    transform: scale(1.05) translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.download-btn:active {
    transform: scale(0.98);
}

/* Success Message */
.success-message {
    background: var(--success-color);
    color: white;
    padding: var(--spacing-md);
    border-radius: var(--radius-lg);
    text-align: center;
    font-weight: 600;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    max-width: 1400px;
    margin: var(--spacing-md) auto 0;
    box-shadow: var(--shadow-md);
}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

@keyframes flash {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.3;
    }
}

.step.active {
    animation: fadeIn 0.4s ease;
}

/* Camera flash effect */
.photo-canvas.flash {
    animation: flash 0.3s ease;
}

/* ===== RESPONSIVE DESIGN ===== */

/* Tablet */
@media (max-width: 1024px) {
    .photo-booth-container {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .preview-section {
        position: static;
    }
    
    .app-header h1 {
        font-size: 1.5rem;
    }
}

/* Mobile */
@media (max-width: 640px) {
    .photo-booth-container {
        padding: 0 var(--spacing-sm);
        margin: var(--spacing-sm) auto;
    }
    
    .app-header {
        padding: var(--spacing-sm);
    }
    
    .header-content {
        flex-direction: column;
        align-items: stretch;
    }
    
    .header-controls {
        justify-content: space-between;
    }
    
    .preview-frame {
        padding: var(--spacing-sm);
    }
    
    .step {
        padding: var(--spacing-md);
    }
    
    .background-gallery {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .pose-selector {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .primary-btn {
        min-width: 100%;
        font-size: 1.25rem;
        padding: var(--spacing-sm) var(--spacing-md);
    }
    
    .button-container {
        flex-direction: column;
    }
    
    .upload-zone {
        padding: var(--spacing-md);
        min-height: 150px;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .step {
        border: 2px solid var(--text-dark);
    }
    
    .background-option,
    .pose-btn {
        border-width: 3px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Print styles */
@media print {
    .app-header,
    .control-panel,
    .action-footer {
        display: none;
    }
    
    .photo-booth-container {
        grid-template-columns: 1fr;
    }
    
    .preview-section {
        max-width: 100%;
    }
}
    </style>
</head>
<body>
    
    <!-- Header with title and controls -->
    <header class="app-header" role="banner">
        <div class="header-content">
            <h1>
                <span class="emoji" aria-hidden="true">üéÆ</span>
                <span data-en="Minecraft Photo Booth" data-es="Cabina de Fotos de Minecraft">Minecraft Photo Booth</span>
                <span class="emoji" aria-hidden="true">üì∏</span>
            </h1>
            
            <div class="header-controls">
                <!-- Language Toggle -->
                <div class="language-toggle" role="group" aria-label="Language selection">
                    <button id="lang-en" class="lang-btn active" 
                            aria-pressed="true" 
                            data-lang="en">
                        EN
                    </button>
                    <button id="lang-es" class="lang-btn" 
                            aria-pressed="false" 
                            data-lang="es">
                        ES
                    </button>
                </div>
                
                <!-- Audio Help Button -->
                <button id="audio-help-btn" class="help-btn" 
                        aria-label="Audio help">
                    <span class="emoji" aria-hidden="true">üîä</span>
                    <span class="sr-only" data-en="Audio Help" data-es="Ayuda de Audio">Audio Help</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="photo-booth-container" role="main">
        
        <!-- Left Side: Preview Area -->
        <section class="preview-section" aria-label="Photo preview">
            <div class="preview-frame">
                <h2 class="sr-only" data-en="Your Photo Preview" data-es="Vista Previa de tu Foto">Your Photo Preview</h2>
                
                <!-- Canvas for composited final image -->
                <canvas id="photo-canvas" class="photo-canvas" aria-label="Photo preview canvas"></canvas>
                
                <!-- Three.js container for 3D character -->
                <div id="character-preview" class="character-preview" aria-live="polite"></div>
                
                <!-- Placeholder when no skin loaded -->
                <div id="preview-placeholder" class="preview-placeholder">
                    <span class="emoji large" aria-hidden="true">üé®</span>
                    <p data-en="Upload your skin to begin!" data-es="¬°Sube tu skin para comenzar!">Upload your skin to begin!</p>
                </div>
            </div>
        </section>

        <!-- Right Side: Control Panel -->
        <aside class="control-panel" role="complementary">
            
            <!-- Step 1: Upload Skin -->
            <div class="step step-1 active" id="step-1" data-step="1">
                <div class="step-header">
                    <span class="step-number" aria-hidden="true">1</span>
                    <h2 data-en="Your Skin" data-es="Tu Skin">Your Skin</h2>
                </div>
                
                <div class="step-content">
                    <!-- Upload Zone -->
                    <div class="upload-zone" id="upload-zone" 
                         role="button" 
                         tabindex="0"
                         aria-label="Click or drag to upload skin file">
                        <input type="file" 
                               id="skin-file-input" 
                               accept=".png,.mcpack" 
                               class="file-input"
                               aria-label="Choose skin file">
                        
                        <div class="upload-content">
                            <span class="emoji large" aria-hidden="true">üìÅ</span>
                            <p class="upload-text">
                                <strong data-en="Choose File" data-es="Elegir Archivo">Choose File</strong><br>
                                <span class="secondary-text" data-en="or drag here" data-es="o arrastra aqu√≠">or drag here</span>
                            </p>
                            <p class="upload-hint" data-en="PNG or MCPACK files" data-es="Archivos PNG o MCPACK">PNG or MCPACK files</p>
                        </div>
                    </div>
                    
                    <!-- Upload Status -->
                    <div id="upload-status" class="upload-status" role="status" aria-live="polite"></div>
                </div>
            </div>

            <!-- Step 2: Choose Background -->
            <div class="step step-2" id="step-2" data-step="2">
                <div class="step-header">
                    <span class="step-number" aria-hidden="true">2</span>
                    <h2 data-en="Background" data-es="Fondo">Background</h2>
                </div>
                
                <div class="step-content">
                    <div class="background-gallery" role="radiogroup" aria-label="Choose background">
                        
                        <button class="background-option" 
                                data-background="mountains"
                                role="radio"
                                aria-checked="false"
                                aria-label="Mountain biome background">
                            <span class="emoji" aria-hidden="true">üèîÔ∏è</span>
                            <span class="bg-label" data-en="Mountains" data-es="Monta√±as">Mountains</span>
                        </button>
                        
                        <button class="background-option" 
                                data-background="forest"
                                role="radio"
                                aria-checked="false"
                                aria-label="Forest biome background">
                            <span class="emoji" aria-hidden="true">üå≥</span>
                            <span class="bg-label" data-en="Forest" data-es="Bosque">Forest</span>
                        </button>
                        
                        <button class="background-option" 
                                data-background="castle"
                                role="radio"
                                aria-checked="false"
                                aria-label="Castle background">
                            <span class="emoji" aria-hidden="true">üè∞</span>
                            <span class="bg-label" data-en="Castle" data-es="Castillo">Castle</span>
                        </button>
                        
                        <button class="background-option" 
                                data-background="ocean"
                                role="radio"
                                aria-checked="false"
                                aria-label="Ocean biome background">
                            <span class="emoji" aria-hidden="true">üåä</span>
                            <span class="bg-label" data-en="Ocean" data-es="Oc√©ano">Ocean</span>
                        </button>
                        
                        <button class="background-option" 
                                data-background="nether"
                                role="radio"
                                aria-checked="false"
                                aria-label="Nether background">
                            <span class="emoji" aria-hidden="true">üî•</span>
                            <span class="bg-label" data-en="Nether" data-es="Infierno">Nether</span>
                        </button>
                        
                        <button class="background-option" 
                                data-background="end"
                                role="radio"
                                aria-checked="false"
                                aria-label="End dimension background">
                            <span class="emoji" aria-hidden="true">‚≠ê</span>
                            <span class="bg-label" data-en="The End" data-es="El End">The End</span>
                        </button>
                        
                    </div>
                    
                    <div id="background-status" class="background-status" role="status" aria-live="polite"></div>
                </div>
            </div>

            <!-- Step 3: Adjust Photo -->
            <div class="step step-3" id="step-3" data-step="3">
                <div class="step-header">
                    <span class="step-number" aria-hidden="true">3</span>
                    <h2 data-en="Adjust" data-es="Ajustar">Adjust</h2>
                </div>
                
                <div class="step-content">
                    <!-- Zoom Control -->
                    <div class="control-group">
                        <label for="zoom-slider" data-en="Zoom" data-es="Zoom">Zoom</label>
                        <input type="range" 
                               id="zoom-slider" 
                               class="zoom-slider"
                               min="0.5" 
                               max="2" 
                               step="0.1" 
                               value="1"
                               aria-label="Zoom level"
                               aria-valuemin="0.5"
                               aria-valuemax="2"
                               aria-valuenow="1">
                        <span id="zoom-value" class="slider-value">100%</span>
                    </div>
                    
                    <!-- Pose Selector -->
                    <div class="control-group">
                        <label data-en="Pose" data-es="Pose">Pose</label>
                        <div class="pose-selector" role="radiogroup" aria-label="Character pose">
                            
                            <button class="pose-btn active" 
                                    data-pose="standing"
                                    role="radio"
                                    aria-checked="true"
                                    aria-label="Standing pose">
                                <span class="emoji" aria-hidden="true">üßç</span>
                                <span class="pose-label" data-en="Stand" data-es="Parado">Stand</span>
                            </button>
                            
                            <button class="pose-btn" 
                                    data-pose="running"
                                    role="radio"
                                    aria-checked="false"
                                    aria-label="Running pose">
                                <span class="emoji" aria-hidden="true">üèÉ</span>
                                <span class="pose-label" data-en="Run" data-es="Correr">Run</span>
                            </button>
                            
                            <button class="pose-btn" 
                                    data-pose="action"
                                    role="radio"
                                    aria-checked="false"
                                    aria-label="Action pose">
                                <span class="emoji" aria-hidden="true">‚öîÔ∏è</span>
                                <span class="pose-label" data-en="Action" data-es="Acci√≥n">Action</span>
                            </button>
                            
                        </div>
                    </div>
                </div>
            </div>

        </aside>

    </main>

    <!-- Action Buttons Footer -->
    <footer class="action-footer" role="contentinfo">
        <div class="button-container">
            
            <!-- Take Photo Button -->
            <button id="take-photo-btn" 
                    class="primary-btn take-photo-btn" 
                    disabled
                    aria-label="Take photo">
                <span class="emoji" aria-hidden="true">üì∏</span>
                <span data-en="Take Photo!" data-es="¬°Tomar Foto!">Take Photo!</span>
            </button>
            
            <!-- Download Button (hidden initially) -->
            <button id="download-btn" 
                    class="primary-btn download-btn" 
                    hidden
                    aria-label="Download photo">
                <span class="emoji" aria-hidden="true">‚¨áÔ∏è</span>
                <span data-en="Download Photo" data-es="Descargar Foto">Download Photo</span>
            </button>
            
        </div>
        
        <!-- Success Message -->
        <div id="success-message" class="success-message" role="status" aria-live="polite" hidden>
            <span class="emoji" aria-hidden="true">‚úÖ</span>
            <span data-en="Your photo is ready!" data-es="¬°Tu foto est√° lista!">Your photo is ready!</span>
        </div>
    </footer>

    <!-- Screen Reader Only Status Updates -->
    <div class="sr-only" role="status" aria-live="polite" aria-atomic="true" id="sr-status"></div>

    <!-- JavaScript -->
    <script>
/* ============================================
   MINECRAFT PHOTO BOOTH JAVASCRIPT
   Handles file upload, 3D rendering, and all interactions
   ============================================ */

// ===== GLOBAL STATE =====
const state = {
    currentLanguage: 'en',
    skinLoaded: false,
    backgroundSelected: false,
    skinTexture: null,
    selectedBackground: null,
    selectedPose: 'standing',
    zoomLevel: 1,
    scene: null,
    camera: null,
    renderer: null,
    character: null,
    animationId: null
};

// ===== TRANSLATIONS =====
const translations = {
    en: {
        skinLoadedSuccess: "‚úì Skin loaded successfully!",
        skinLoadedError: "Error loading skin. Please try a different file.",
        backgroundSelected: "‚úì Background selected!",
        photoReady: "Your photo is ready!",
        srSkinLoaded: "Skin loaded. You can now choose a background.",
        srBackgroundSelected: "Background selected. You can now adjust and take your photo.",
        srPhotoTaken: "Photo taken! Click download to save your image."
    },
    es: {
        skinLoadedSuccess: "‚úì ¬°Skin cargado exitosamente!",
        skinLoadedError: "Error al cargar el skin. Por favor intenta con otro archivo.",
        backgroundSelected: "‚úì ¬°Fondo seleccionado!",
        photoReady: "¬°Tu foto est√° lista!",
        srSkinLoaded: "Skin cargado. Ahora puedes elegir un fondo.",
        srBackgroundSelected: "Fondo seleccionado. Ahora puedes ajustar y tomar tu foto.",
        srPhotoTaken: "¬°Foto tomada! Haz clic en descargar para guardar tu imagen."
    }
};

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
    console.log('üéÆ Minecraft Photo Booth initializing...');
    
    initLanguageToggle();
    initFileUpload();
    initBackgroundSelector();
    initAdjustControls();
    initActionButtons();
    initThreeJS();
    
    console.log('‚úÖ Photo Booth ready!');
});

// ===== LANGUAGE SWITCHING =====
function initLanguageToggle() {
    const enBtn = document.getElementById('lang-en');
    const esBtn = document.getElementById('lang-es');
    
    enBtn.addEventListener('click', () => switchLanguage('en'));
    esBtn.addEventListener('click', () => switchLanguage('es'));
}

function switchLanguage(lang) {
    state.currentLanguage = lang;
    
    // Update button states
    document.querySelectorAll('.lang-btn').forEach(btn => {
        const isActive = btn.dataset.lang === lang;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive);
    });
    
    // Update all text elements
    document.querySelectorAll('[data-en]').forEach(element => {
        const text = element.getAttribute(`data-${lang}`);
        if (text) {
            element.textContent = text;
        }
    });
    
    console.log(`üåç Language switched to: ${lang}`);
}

// ===== FILE UPLOAD HANDLING =====
function initFileUpload() {
    const uploadZone = document.getElementById('upload-zone');
    const fileInput = document.getElementById('skin-file-input');
    const uploadStatus = document.getElementById('upload-status');
    
    // Click to upload
    uploadZone.addEventListener('click', () => {
        fileInput.click();
    });
    
    // Keyboard support
    uploadZone.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            fileInput.click();
        }
    });
    
    // File selection
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            handleFileUpload(file);
        }
    });
    
    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragging');
    });
    
    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragging');
    });
    
    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragging');
        
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileUpload(file);
        }
    });
}

async function handleFileUpload(file) {
    console.log('üìÅ Processing file:', file.name);
    
    const uploadStatus = document.getElementById('upload-status');
    const validTypes = ['image/png', 'application/octet-stream'];
    const validExtensions = ['.png', '.mcpack'];
    
    // Check file type
    const fileExtension = file.name.toLowerCase().slice(file.name.lastIndexOf('.'));
    if (!validTypes.includes(file.type) && !validExtensions.includes(fileExtension)) {
        showUploadStatus('error', translations[state.currentLanguage].skinLoadedError);
        return;
    }
    
    try {
        let skinImageData;
        
        if (fileExtension === '.mcpack') {
            // Handle MCPACK file
            skinImageData = await extractSkinFromMCPACK(file);
        } else {
            // Handle PNG file
            skinImageData = await loadPNGFile(file);
        }
        
        if (skinImageData) {
            state.skinTexture = skinImageData;
            state.skinLoaded = true;
            
            // Show success
            showUploadStatus('success', translations[state.currentLanguage].skinLoadedSuccess);
            announceToScreenReader(translations[state.currentLanguage].srSkinLoaded);
            
            // Apply skin to character
            applySkinToCharacter(skinImageData);
            
            // Hide placeholder and show preview
            document.getElementById('preview-placeholder').style.display = 'none';
            
            // Enable next step
            enableStep(2);
            
            console.log('‚úÖ Skin loaded successfully');
        }
    } catch (error) {
        console.error('‚ùå Error loading skin:', error);
        showUploadStatus('error', translations[state.currentLanguage].skinLoadedError);
    }
}

function loadPNGFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                // Validate skin dimensions (64x32 or 64x64)
                if ((img.width === 64 && img.height === 32) || 
                    (img.width === 64 && img.height === 64)) {
                    resolve(img);
                } else {
                    reject(new Error('Invalid skin dimensions. Must be 64x32 or 64x64.'));
                }
            };
            img.onerror = () => reject(new Error('Failed to load image'));
            img.src = e.target.result;
        };
        
        reader.onerror = () => reject(new Error('Failed to read file'));
        reader.readAsDataURL(file);
    });
}

async function extractSkinFromMCPACK(file) {
    try {
        const zip = await JSZip.loadAsync(file);
        
        // Look for skin file (commonly in skins/ folder)
        let skinFile = null;
        
        // Check common paths
        const possiblePaths = [
            'skins/skin.png',
            'skin.png',
            'skins/0.png'
        ];
        
        for (const path of possiblePaths) {
            if (zip.files[path]) {
                skinFile = zip.files[path];
                break;
            }
        }
        
        // If not found in common paths, search all PNG files
        if (!skinFile) {
            for (const filename in zip.files) {
                if (filename.toLowerCase().endsWith('.png') && 
                    !zip.files[filename].dir) {
                    skinFile = zip.files[filename];
                    break;
                }
            }
        }
        
        if (!skinFile) {
            throw new Error('No skin file found in MCPACK');
        }
        
        // Extract and load the image
        const blob = await skinFile.async('blob');
        const file = new File([blob], 'skin.png', { type: 'image/png' });
        
        return await loadPNGFile(file);
    } catch (error) {
        console.error('Error extracting MCPACK:', error);
        throw error;
    }
}

function showUploadStatus(type, message) {
    const uploadStatus = document.getElementById('upload-status');
    uploadStatus.className = `upload-status ${type}`;
    uploadStatus.textContent = message;
    uploadStatus.style.display = 'block';
}

// ===== PROGRESSIVE DISCLOSURE =====
function enableStep(stepNumber) {
    const step = document.getElementById(`step-${stepNumber}`);
    if (step) {
        step.classList.add('active');
        console.log(`‚ú® Step ${stepNumber} enabled`);
    }
}

function disableStep(stepNumber) {
    const step = document.getElementById(`step-${stepNumber}`);
    if (step) {
        step.classList.remove('active');
    }
}

// ===== BACKGROUND SELECTOR =====
function initBackgroundSelector() {
    const backgroundButtons = document.querySelectorAll('.background-option');
    
    backgroundButtons.forEach(button => {
        button.addEventListener('click', () => {
            selectBackground(button);
        });
        
        // Keyboard support
        button.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                selectBackground(button);
            }
        });
    });
}

function selectBackground(button) {
    if (!state.skinLoaded) return;
    
    const backgroundName = button.dataset.background;
    state.selectedBackground = backgroundName;
    state.backgroundSelected = true;
    
    // Update button states
    document.querySelectorAll('.background-option').forEach(btn => {
        const isSelected = btn === button;
        btn.setAttribute('aria-checked', isSelected);
        btn.classList.toggle('active', isSelected);
    });
    
    // Show status
    const bgStatus = document.getElementById('background-status');
    bgStatus.className = 'background-status success';
    bgStatus.textContent = translations[state.currentLanguage].backgroundSelected;
    
    // Announce to screen reader
    announceToScreenReader(translations[state.currentLanguage].srBackgroundSelected);
    
    // Update background in preview
    updateBackgroundInScene(backgroundName);
    
    // Enable next step and take photo button
    enableStep(3);
    document.getElementById('take-photo-btn').disabled = false;
    
    console.log(`üåç Background selected: ${backgroundName}`);
}

// ===== ADJUST CONTROLS =====
function initAdjustControls() {
    // Zoom slider
    const zoomSlider = document.getElementById('zoom-slider');
    const zoomValue = document.getElementById('zoom-value');
    
    zoomSlider.addEventListener('input', (e) => {
        const value = parseFloat(e.target.value);
        state.zoomLevel = value;
        zoomValue.textContent = `${Math.round(value * 100)}%`;
        
        // Update character scale
        if (state.character) {
            state.character.scale.set(value, value, value);
        }
    });
    
    // Pose selector
    const poseButtons = document.querySelectorAll('.pose-btn');
    
    poseButtons.forEach(button => {
        button.addEventListener('click', () => {
            selectPose(button);
        });
        
        // Keyboard support
        button.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                selectPose(button);
            }
        });
    });
}

function selectPose(button) {
    const pose = button.dataset.pose;
    state.selectedPose = pose;
    
    // Update button states
    document.querySelectorAll('.pose-btn').forEach(btn => {
        const isSelected = btn === button;
        btn.setAttribute('aria-checked', isSelected);
        btn.classList.toggle('active', isSelected);
    });
    
    // Apply pose to character
    applyPoseToCharacter(pose);
    
    console.log(`üèÉ Pose selected: ${pose}`);
}

// ===== ACTION BUTTONS =====
function initActionButtons() {
    const takePhotoBtn = document.getElementById('take-photo-btn');
    const downloadBtn = document.getElementById('download-btn');
    const audioHelpBtn = document.getElementById('audio-help-btn');
    
    takePhotoBtn.addEventListener('click', takePhoto);
    downloadBtn.addEventListener('click', downloadPhoto);
    audioHelpBtn.addEventListener('click', playAudioHelp);
}

function takePhoto() {
    console.log('üì∏ Taking photo...');
    
    const canvas = document.getElementById('photo-canvas');
    const photoRenderer = state.renderer;
    
    // Flash effect
    canvas.classList.add('flash');
    setTimeout(() => canvas.classList.remove('flash'), 300);
    
    // Play camera sound (if we add audio later)
    // playCameraSound();
    
    // Render the final photo
    renderFinalPhoto();
    
    // Show download button
    document.getElementById('take-photo-btn').style.display = 'none';
    document.getElementById('download-btn').hidden = false;
    
    // Show success message
    const successMsg = document.getElementById('success-message');
    successMsg.hidden = false;
    successMsg.textContent = translations[state.currentLanguage].photoReady;
    
    // Announce to screen reader
    announceToScreenReader(translations[state.currentLanguage].srPhotoTaken);
    
    console.log('‚úÖ Photo ready for download');
}

function renderFinalPhoto() {
    const canvas = document.getElementById('photo-canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size (square photo)
    const size = 1024;
    canvas.width = size;
    canvas.height = size;
    
    // Get the current Three.js renderer canvas
    const rendererCanvas = state.renderer.domElement;
    
    // Draw background (solid color for now - will be replaced with actual backgrounds)
    const bgColors = {
        mountains: '#87CEEB',
        forest: '#228B22',
        castle: '#A0A0A0',
        ocean: '#1E90FF',
        nether: '#8B0000',
        end: '#1A1A2E'
    };
    
    ctx.fillStyle = bgColors[state.selectedBackground] || '#87CEEB';
    ctx.fillRect(0, 0, size, size);
    
    // Draw the 3D character on top
    ctx.drawImage(rendererCanvas, 0, 0, size, size);
}

function downloadPhoto() {
    const canvas = document.getElementById('photo-canvas');
    const link = document.createElement('a');
    const timestamp = new Date().toISOString().slice(0, 10);
    
    link.download = `minecraft-photo-${timestamp}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
    
    console.log('‚¨áÔ∏è Photo downloaded');
}

function playAudioHelp() {
    // Text-to-speech functionality
    const helpText = state.currentLanguage === 'en' 
        ? 'Upload your Minecraft skin, choose a background, adjust your character, and take a photo!'
        : '¬°Sube tu skin de Minecraft, elige un fondo, ajusta tu personaje y toma una foto!';
    
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(helpText);
        utterance.lang = state.currentLanguage === 'en' ? 'en-US' : 'es-ES';
        utterance.rate = 0.9;
        window.speechSynthesis.speak(utterance);
        console.log('üîä Audio help played');
    }
}

// ===== THREE.JS 3D CHARACTER RENDERING =====
function initThreeJS() {
    const container = document.getElementById('character-preview');
    
    // Create scene
    state.scene = new THREE.Scene();
    state.scene.background = null; // Transparent for now
    
    // Create camera
    const aspect = 1; // Square aspect ratio
    state.camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000);
    state.camera.position.set(0, 0, 30);
    state.camera.lookAt(0, 0, 0);
    
    // Create renderer
    state.renderer = new THREE.WebGLRenderer({ 
        antialias: true, 
        alpha: true,
        preserveDrawingBuffer: true // Important for canvas export
    });
    state.renderer.setSize(512, 512);
    state.renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(state.renderer.domElement);
    
    // Add lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    state.scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(5, 10, 7);
    state.scene.add(directionalLight);
    
    // Start animation loop
    animate();
    
    console.log('üé® Three.js initialized');
}

function applySkinToCharacter(skinImage) {
    // Remove old character if exists
    if (state.character) {
        state.scene.remove(state.character);
    }
    
    // Create texture from skin image
    const texture = new THREE.Texture(skinImage);
    texture.magFilter = THREE.NearestFilter;
    texture.minFilter = THREE.NearestFilter;
    texture.needsUpdate = true;
    
    // Create character model
    state.character = createMinecraftCharacter(texture);
    state.character.position.set(0, 0, 0);
    state.character.scale.set(state.zoomLevel, state.zoomLevel, state.zoomLevel);
    
    state.scene.add(state.character);
    
    console.log('üë§ Character model created');
}

function createMinecraftCharacter(skinTexture) {
    const group = new THREE.Group();
    const material = new THREE.MeshLambertMaterial({ 
        map: skinTexture,
        transparent: false
    });
    
    // Character proportions (8x8x8 head, 8x12x4 body, 4x12x4 limbs)
    const scale = 1;
    
    // Head
    const headGeo = new THREE.BoxGeometry(8 * scale, 8 * scale, 8 * scale);
    const head = new THREE.Mesh(headGeo, material);
    head.position.y = 10 * scale;
    
    // Apply UV mapping for head (front, back, right, left, top, bottom)
    const headUVs = getHeadUVs();
    headGeo.faceVertexUvs[0] = headUVs;
    headGeo.uvsNeedUpdate = true;
    
    group.add(head);
    
    // Body
    const bodyGeo = new THREE.BoxGeometry(8 * scale, 12 * scale, 4 * scale);
    const body = new THREE.Mesh(bodyGeo, material);
    body.position.y = 0;
    
    const bodyUVs = getBodyUVs();
    bodyGeo.faceVertexUvs[0] = bodyUVs;
    bodyGeo.uvsNeedUpdate = true;
    
    group.add(body);
    
    // Right Arm
    const armGeo = new THREE.BoxGeometry(4 * scale, 12 * scale, 4 * scale);
    const rightArm = new THREE.Mesh(armGeo, material);
    rightArm.position.set(-6 * scale, 0, 0);
    
    const rightArmUVs = getRightArmUVs();
    armGeo.faceVertexUvs[0] = rightArmUVs;
    armGeo.uvsNeedUpdate = true;
    
    group.add(rightArm);
    
    // Left Arm
    const leftArmGeo = new THREE.BoxGeometry(4 * scale, 12 * scale, 4 * scale);
    const leftArm = new THREE.Mesh(leftArmGeo, material);
    leftArm.position.set(6 * scale, 0, 0);
    
    const leftArmUVs = getLeftArmUVs();
    leftArmGeo.faceVertexUvs[0] = leftArmUVs;
    leftArmGeo.uvsNeedUpdate = true;
    
    group.add(leftArm);
    
    // Right Leg
    const legGeo = new THREE.BoxGeometry(4 * scale, 12 * scale, 4 * scale);
    const rightLeg = new THREE.Mesh(legGeo, material);
    rightLeg.position.set(-2 * scale, -12 * scale, 0);
    
    const rightLegUVs = getRightLegUVs();
    legGeo.faceVertexUvs[0] = rightLegUVs;
    legGeo.uvsNeedUpdate = true;
    
    group.add(rightLeg);
    
    // Left Leg
    const leftLegGeo = new THREE.BoxGeometry(4 * scale, 12 * scale, 4 * scale);
    const leftLeg = new THREE.Mesh(leftLegGeo, material);
    leftLeg.position.set(2 * scale, -12 * scale, 0);
    
    const leftLegUVs = getLeftLegUVs();
    leftLegGeo.faceVertexUvs[0] = leftLegUVs;
    leftLegGeo.uvsNeedUpdate = true;
    
    group.add(leftLeg);
    
    // Store body parts for animation
    group.userData = {
        head,
        body,
        rightArm,
        leftArm,
        rightLeg,
        leftLeg
    };
    
    return group;
}

// UV Mapping Functions (simplified - these map texture coordinates to faces)
function getHeadUVs() {
    const s = 64; // Texture size
    return [
        // Right face
        [uv(16/s, 8/s), uv(8/s, 8/s), uv(16/s, 0/s), uv(8/s, 0/s)],
        // Left face
        [uv(0/s, 8/s), uv(8/s, 8/s), uv(0/s, 0/s), uv(8/s, 0/s)],
        // Top face
        [uv(8/s, 0/s), uv(16/s, 0/s), uv(8/s, 8/s), uv(16/s, 8/s)],
        // Bottom face
        [uv(16/s, 0/s), uv(24/s, 0/s), uv(16/s, 8/s), uv(24/s, 8/s)],
        // Front face
        [uv(8/s, 16/s), uv(16/s, 16/s), uv(8/s, 8/s), uv(16/s, 8/s)],
        // Back face
        [uv(24/s, 16/s), uv(32/s, 16/s), uv(24/s, 8/s), uv(32/s, 8/s)]
    ];
}

function getBodyUVs() {
    const s = 64;
    return [
        // Right
        [uv(28/s, 20/s), uv(20/s, 20/s), uv(28/s, 8/s), uv(20/s, 8/s)],
        // Left
        [uv(16/s, 20/s), uv(20/s, 20/s), uv(16/s, 8/s), uv(20/s, 8/s)],
        // Top
        [uv(20/s, 16/s), uv(28/s, 16/s), uv(20/s, 20/s), uv(28/s, 20/s)],
        // Bottom
        [uv(28/s, 16/s), uv(36/s, 16/s), uv(28/s, 20/s), uv(36/s, 20/s)],
        // Front
        [uv(20/s, 32/s), uv(28/s, 32/s), uv(20/s, 20/s), uv(28/s, 20/s)],
        // Back
        [uv(32/s, 32/s), uv(40/s, 32/s), uv(32/s, 20/s), uv(40/s, 20/s)]
    ];
}

function getRightArmUVs() {
    const s = 64;
    return [
        [uv(44/s, 20/s), uv(40/s, 20/s), uv(44/s, 8/s), uv(40/s, 8/s)],
        [uv(48/s, 20/s), uv(44/s, 20/s), uv(48/s, 8/s), uv(44/s, 8/s)],
        [uv(44/s, 16/s), uv(48/s, 16/s), uv(44/s, 20/s), uv(48/s, 20/s)],
        [uv(48/s, 16/s), uv(52/s, 16/s), uv(48/s, 20/s), uv(52/s, 20/s)],
        [uv(44/s, 32/s), uv(48/s, 32/s), uv(44/s, 20/s), uv(48/s, 20/s)],
        [uv(52/s, 32/s), uv(56/s, 32/s), uv(52/s, 20/s), uv(56/s, 20/s)]
    ];
}

function getLeftArmUVs() {
    const s = 64;
    return [
        [uv(36/s, 52/s), uv(32/s, 52/s), uv(36/s, 40/s), uv(32/s, 40/s)],
        [uv(40/s, 52/s), uv(36/s, 52/s), uv(40/s, 40/s), uv(36/s, 40/s)],
        [uv(36/s, 48/s), uv(40/s, 48/s), uv(36/s, 52/s), uv(40/s, 52/s)],
        [uv(40/s, 48/s), uv(44/s, 48/s), uv(40/s, 52/s), uv(44/s, 52/s)],
        [uv(36/s, 64/s), uv(40/s, 64/s), uv(36/s, 52/s), uv(40/s, 52/s)],
        [uv(44/s, 64/s), uv(48/s, 64/s), uv(44/s, 52/s), uv(48/s, 52/s)]
    ];
}

function getRightLegUVs() {
    const s = 64;
    return [
        [uv(4/s, 20/s), uv(0/s, 20/s), uv(4/s, 8/s), uv(0/s, 8/s)],
        [uv(8/s, 20/s), uv(4/s, 20/s), uv(8/s, 8/s), uv(4/s, 8/s)],
        [uv(4/s, 16/s), uv(8/s, 16/s), uv(4/s, 20/s), uv(8/s, 20/s)],
        [uv(8/s, 16/s), uv(12/s, 16/s), uv(8/s, 20/s), uv(12/s, 20/s)],
        [uv(4/s, 32/s), uv(8/s, 32/s), uv(4/s, 20/s), uv(8/s, 20/s)],
        [uv(12/s, 32/s), uv(16/s, 32/s), uv(12/s, 20/s), uv(16/s, 20/s)]
    ];
}

function getLeftLegUVs() {
    const s = 64;
    return [
        [uv(20/s, 52/s), uv(16/s, 52/s), uv(20/s, 40/s), uv(16/s, 40/s)],
        [uv(24/s, 52/s), uv(20/s, 52/s), uv(24/s, 40/s), uv(20/s, 40/s)],
        [uv(20/s, 48/s), uv(24/s, 48/s), uv(20/s, 52/s), uv(24/s, 52/s)],
        [uv(24/s, 48/s), uv(28/s, 48/s), uv(24/s, 52/s), uv(28/s, 52/s)],
        [uv(20/s, 64/s), uv(24/s, 64/s), uv(20/s, 52/s), uv(24/s, 52/s)],
        [uv(28/s, 64/s), uv(32/s, 64/s), uv(28/s, 52/s), uv(32/s, 52/s)]
    ];
}

function uv(u, v) {
    return new THREE.Vector2(u, 1 - v); // Flip V coordinate
}

function applyPoseToCharacter(pose) {
    if (!state.character) return;
    
    const parts = state.character.userData;
    
    // Reset all rotations
    Object.values(parts).forEach(part => {
        part.rotation.set(0, 0, 0);
    });
    
    switch(pose) {
        case 'standing':
            // Default standing pose (already reset)
            break;
            
        case 'running':
            // Running pose - arms and legs swinging
            parts.rightArm.rotation.x = -0.5;
            parts.leftArm.rotation.x = 0.5;
            parts.rightLeg.rotation.x = 0.5;
            parts.leftLeg.rotation.x = -0.5;
            break;
            
        case 'action':
            // Action pose - arm raised
            parts.rightArm.rotation.x = -1.5;
            parts.rightArm.rotation.z = -0.3;
            parts.body.rotation.y = 0.2;
            break;
    }
}

function updateBackgroundInScene(backgroundName) {
    // For now, just update the scene background color
    const bgColors = {
        mountains: 0x87CEEB,
        forest: 0x228B22,
        castle: 0xA0A0A0,
        ocean: 0x1E90FF,
        nether: 0x8B0000,
        end: 0x1A1A2E
    };
    
    state.scene.background = new THREE.Color(bgColors[backgroundName] || 0x87CEEB);
}

function animate() {
    state.animationId = requestAnimationFrame(animate);
    
    // Slowly rotate character for a nice view
    if (state.character) {
        state.character.rotation.y += 0.005;
    }
    
    state.renderer.render(state.scene, state.camera);
}

// ===== SCREEN READER ANNOUNCEMENTS =====
function announceToScreenReader(message) {
    const srStatus = document.getElementById('sr-status');
    srStatus.textContent = message;
    
    // Clear after 1 second
    setTimeout(() => {
        srStatus.textContent = '';
    }, 1000);
}

// ===== RESPONSIVE HANDLING =====
window.addEventListener('resize', () => {
    if (state.renderer && state.camera) {
        const container = document.getElementById('character-preview');
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        state.renderer.setSize(width, height);
        state.camera.aspect = width / height;
        state.camera.updateProjectionMatrix();
    }
});

// ===== CLEANUP =====
window.addEventListener('beforeunload', () => {
    if (state.animationId) {
        cancelAnimationFrame(state.animationId);
    }
    if (state.renderer) {
        state.renderer.dispose();
    }
});

console.log('üéÆ Minecraft Photo Booth script loaded!');
    </script>
    
</body>
</html>
